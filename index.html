<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Inverted Sentences Jumble</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f3ff; /* Light purple background */
        }
        /* Style for the element being dragged */
        .dragging {
            opacity: 0.6;
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        /* Draggable word tiles */
        .draggable {
            cursor: grab;
            user-select: none;
            transition: all 0.2s ease-in-out;
        }
        .draggable:active {
            cursor: grabbing;
        }
        /* The container holding the jumbled words */
        .source-container {
            background: #eef2ff; /* Lighter indigo */
            border: 2px dashed #c7d2fe;
        }
        /* The container where the user builds the sentence */
        .target-container.drag-over {
            background-color: #fefce8; /* Light yellow on drag over */
            border-color: #facc15;
        }
        /* AI Button animation */
        .ai-btn-glow {
            animation: pulse-glow 2s infinite ease-in-out;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px #a78bfa, 0 0 10px #a78bfa; }
            50% { box-shadow: 0 0 20px #8b5cf6, 0 0 30px #8b5cf6; }
        }
        /* Loading spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #8b5cf6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-5xl">
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl md:text-5xl font-bold text-violet-800">AI Sentence Jumble</h1>
            <p class="text-violet-700 mt-2 text-base md:text-lg">Unscramble advanced inverted sentences. Use the AI to create new challenges!</p>
        </header>

        <!-- AI Puzzle Generator -->
        <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 mb-12">
            <h2 class="text-2xl font-bold text-center text-violet-800 mb-4">Magic Puzzle Generator</h2>
            <p class="text-center text-slate-600 mb-6">Click the button to generate a unique sentence puzzle using AI!</p>
            <div class="flex justify-center">
                <button id="generate-ai-puzzle" class="ai-btn-glow flex items-center justify-center gap-3 bg-violet-600 text-white font-bold py-3 px-8 rounded-xl hover:bg-violet-700 transition-all hover:scale-105 shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2.5a2.5 2.5 0 0 1 5 0"/><path d="M6.23 6.23a2.5 2.5 0 0 1 0 3.54l-3.48 3.48a2.5 2.5 0 0 1-3.54-3.54l3.48-3.48a2.5 2.5 0 0 1 3.54 0z"/><path d="M17.77 6.23a2.5 2.5 0 0 1 3.54 0l3.48 3.48a2.5 2.5 0 0 1-3.54 3.54l-3.48-3.48a2.5 2.5 0 0 1 0-3.54z"/><path d="M2.5 14.5a2.5 2.5 0 0 1 0 5"/><path d="M21.5 14.5a2.5 2.5 0 0 0 0 5"/><path d="m6 18 3-3"/><path d="m15 15 3 3"/><path d="m12 6 2 2"/><path d="m10 14 2 2"/></svg>
                    <span>Generate AI Puzzle</span>
                </button>
            </div>
            <div id="ai-status" class="text-center mt-4 min-h-[24px] flex items-center justify-center gap-2 text-slate-500"></div>
            <div id="ai-puzzle-container" class="mt-4"></div>
        </div>

        <main id="puzzle-container" class="space-y-12">
            <!-- Pre-defined puzzles will be dynamically inserted here -->
        </main>
        
        <footer class="text-center mt-12">
            <p class="text-sm text-violet-600">Powered by AI for endless grammar practice!</p>
        </footer>
    </div>

    <script>
        // --- DATA ---
        // An array of more advanced, pre-defined sentence puzzles.
        const initialPuzzles = [
            {
                id: 'seldom',
                prompt: 'Seldom',
                parts: ['do', 'you', 'see', 'such', 'a', 'remarkable', 'performance.'],
            },
            {
                id: 'not-until',
                prompt: 'Not until',
                parts: ['you', 'finish', 'your', 'work', 'can', 'you', 'go', 'outside.'],
            },
            {
                id: 'under-no-circumstances',
                prompt: 'Under no circumstances',
                parts: ['should', 'you', 'press', 'that', 'red', 'button.'],
            },
            {
                id: 'little',
                prompt: 'Little',
                parts: ['did', 'he', 'know', 'what', 'was', 'about', 'to', 'happen.'],
            }
        ];

        // --- DOM ELEMENTS ---
        const puzzleContainer = document.getElementById('puzzle-container');
        const aiPuzzleContainer = document.getElementById('ai-puzzle-container');
        const generateBtn = document.getElementById('generate-ai-puzzle');
        const aiStatus = document.getElementById('ai-status');
        let draggedItem = null;

        // --- FUNCTIONS ---

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * Creates and appends a single puzzle element to a given container.
         * @param {object} puzzle The puzzle data object.
         * @param {HTMLElement} container The DOM element to append the puzzle to.
         */
        function renderSinglePuzzle(puzzle, container) {
            const puzzleEl = document.createElement('div');
            puzzleEl.id = `puzzle-${puzzle.id}`;
            puzzleEl.className = 'bg-white p-5 sm:p-6 rounded-2xl shadow-lg border border-slate-200 animate-fade-in';

            const shuffledParts = shuffleArray([...puzzle.parts]);

            puzzleEl.innerHTML = `
                <div class="mb-4 p-4 rounded-xl source-container">
                    <p class="text-sm font-semibold text-violet-800 mb-3 text-center">JUMBLED WORDS</p>
                    <div id="source-${puzzle.id}" class="flex flex-wrap justify-center gap-2">
                        ${shuffledParts.map(part => `
                            <div class="draggable bg-white py-2 px-4 rounded-lg shadow border border-slate-200" draggable="true" data-text="${part}">
                                ${part}
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="mb-5">
                    <p class="text-sm font-semibold text-slate-600 mb-2">BUILD YOUR SENTENCE HERE</p>
                    <div class="target-container flex items-center flex-wrap gap-2 p-4 min-h-[70px] bg-slate-50 rounded-xl border-2 border-dashed border-slate-300 transition-colors" id="target-${puzzle.id}">
                        <span class="font-bold text-lg text-slate-900">${puzzle.prompt}</span>
                    </div>
                </div>

                <div id="feedback-${puzzle.id}" class="min-h-[28px] mb-5 text-center font-medium flex items-center justify-center gap-2"></div>
                
                <div class="flex flex-col sm:flex-row justify-center items-center gap-3">
                    <button class="check-btn w-full sm:w-auto bg-violet-600 text-white font-bold py-3 px-8 rounded-xl hover:bg-violet-700 transition-transform hover:scale-105 shadow-md" data-puzzle='${JSON.stringify(puzzle)}'>Check Answer</button>
                    <button class="reset-btn w-full sm:w-auto bg-slate-200 text-slate-700 font-bold py-3 px-8 rounded-xl hover:bg-slate-300 transition-transform hover:scale-105" data-id="${puzzle.id}">Reset</button>
                </div>
            `;
            // Prepend new AI puzzles so they appear at the top
            if(container === aiPuzzleContainer) {
                 container.prepend(puzzleEl);
            } else {
                 container.appendChild(puzzleEl);
            }
        }

        /**
         * Checks the user's answer against the correct order.
         * @param {object} puzzle The full puzzle data object.
         */
        function checkAnswer(puzzle) {
            const targetContainer = document.getElementById(`target-${puzzle.id}`);
            const feedbackContainer = document.getElementById(`feedback-${puzzle.id}`);

            const droppedItems = Array.from(targetContainer.querySelectorAll('.draggable'));
            const userAnswer = droppedItems.map(item => item.dataset.text);

            if (JSON.stringify(userAnswer) === JSON.stringify(puzzle.parts)) {
                feedbackContainer.innerHTML = `<span class="text-green-600">Correct! Fantastic job!</span>`;
                targetContainer.classList.add('border-green-500');
                targetContainer.classList.remove('border-red-400');
            } else {
                feedbackContainer.innerHTML = `<span class="text-red-600">Not quite. Try rearranging the words!</span>`;
                targetContainer.classList.add('border-red-400');
                targetContainer.classList.remove('border-green-500');
            }
        }
        
        function resetPuzzle(puzzleId) {
            const sourceContainer = document.getElementById(`source-${puzzleId}`);
            const targetContainer = document.getElementById(`target-${puzzleId}`);
            const feedbackContainer = document.getElementById(`feedback-${puzzleId}`);
            if(!sourceContainer || !targetContainer) return;
            
            const droppedItems = Array.from(targetContainer.querySelectorAll('.draggable'));
            droppedItems.forEach(item => sourceContainer.appendChild(item));

            feedbackContainer.innerHTML = '';
            targetContainer.classList.remove('border-red-400', 'border-green-500');
        }

        /**
         * Calls Gemini API to generate a new puzzle.
         */
        async function generateAIPuzzle() {
            generateBtn.disabled = true;
            aiStatus.innerHTML = '<div class="loader"></div><span>Generating a magical puzzle...</span>';

            const chatHistory = [{
                role: "user",
                parts: [{
                    text: "Generate a single English inverted sentence puzzle. The sentence must start with a negative or limiting adverbial like 'Seldom', 'Little', 'Not until', 'On no account', 'Hardly', or 'Under no circumstances'. Provide the response as a JSON object. The 'prompt' field should be the starting phrase (one to three words). The 'parts' field should be an array of the remaining words in the correct order to complete the sentence."
                }]
            }];

            const payload = {
                contents: chatHistory,
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            prompt: { "type": "STRING" },
                            parts: {
                                type: "ARRAY",
                                items: { "type": "STRING" }
                            }
                        },
                        required: ["prompt", "parts"]
                    }
                }
            };

            try {
                const apiKey = ""; // API key is handled by the environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.statusText}`);
                }

                const result = await response.json();
                const text = result.candidates[0].content.parts[0].text;
                const newPuzzle = JSON.parse(text);
                
                // Add a unique ID to the new puzzle
                newPuzzle.id = `ai-${Date.now()}`;
                
                renderSinglePuzzle(newPuzzle, aiPuzzleContainer);
                aiStatus.innerHTML = '<span class="text-green-600">Success! Your new puzzle is ready below.</span>';

            } catch (error) {
                console.error("AI Generation Error:", error);
                aiStatus.innerHTML = '<span class="text-red-600">Oops! Could not create a puzzle. Please try again.</span>';
            } finally {
                generateBtn.disabled = false;
            }
        }

        // --- GLOBAL EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            // Render the initial set of puzzles
            initialPuzzles.forEach(puzzle => renderSinglePuzzle(puzzle, puzzleContainer));
            
            // Listener for the AI puzzle generator button
            generateBtn.addEventListener('click', generateAIPuzzle);

            // Delegated event listeners for the entire body for better performance
            document.body.addEventListener('click', (e) => {
                if (e.target.classList.contains('check-btn')) {
                    const puzzleData = JSON.parse(e.target.dataset.puzzle);
                    checkAnswer(puzzleData);
                }
                if (e.target.classList.contains('reset-btn')) {
                    resetPuzzle(e.target.dataset.id);
                }
            });
            
            // Drag and drop listeners
            document.body.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('draggable')) {
                    draggedItem = e.target;
                    setTimeout(() => e.target.classList.add('dragging'), 0);
                }
            });

            document.body.addEventListener('dragend', () => {
                if (draggedItem) {
                    draggedItem.classList.remove('dragging');
                    draggedItem = null;
                }
            });

            document.body.addEventListener('dragover', (e) => {
                e.preventDefault();
                const dropTarget = e.target.closest('.target-container, .source-container');
                if (dropTarget && draggedItem) {
                    const afterElement = getDragAfterElement(dropTarget, e.clientX);
                    if (afterElement == null) {
                        dropTarget.appendChild(draggedItem);
                    } else {
                        dropTarget.insertBefore(draggedItem, afterElement);
                    }
                }
            });

            function getDragAfterElement(container, x) {
                const draggableElements = [...container.querySelectorAll('.draggable:not(.dragging)')];
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = x - box.left - box.width / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }
        });
    </script>
</body>
</html>
